{% extends "base.html" %}

{% load static %}

{% load crispy_forms_tags %}

{% block content %}

<div class="container">

    <h1>Our Menu</h1>

    <!-- NEED TO AMEND BOOTSTRAP CLASSES WITH IF/ELSE FOR USER TYPE -->

    {% for category_label, category_items in categorised_items %}
    <div class="category-section mb-4">
        <h2>{{ category_label }}</h2>

        {% for menu_item in category_items %}
        <div class="menu-item row">
            <div class="col-9 col-sm-10">
                <h4 id="menu-item-name-{{ menu_item.id }}">{{ menu_item.name }}</h4>
                <p id="menu-item-description-{{ menu_item.id }}">{{ menu_item.description }}</p>
                <p class="hidden" id="menu-item-image-{{ menu_item.id }}">{{ menu_item.image.url }}</p>
                <p id="menu-item-price-{{ menu_item.id }}">Price: Â£{{ menu_item.price }}</p>
                <p class="hidden" id="menu-item-is-available-{{ menu_item.id }}">{{ menu_item.is_available }}</p>
            </div>

            {% if user.is_authenticated and user.is_superuser %}
            <div class="col-3 col-sm-2">
                <!-- Edit Button -->
                <div class="row mb-2">
                    <div class="col-12">
                        <a href="#" class="btn btn-warning btn-sm edit-btn" data-menu-item-id="{{ menu_item.id }}">
                            <i class="fas fa-cogs"></i> Edit
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <a href="#" class="btn btn-danger btn-sm delete-btn">
                            <i class="fas fa-trash-alt"></i> Delete
                        </a>
                    </div>
                </div>
            </div>
            <!-- Edit Form (Initially hidden) -->
            <div class="row edit-form-row" id="edit-form-{{ menu_item.id }}">
                <div class="col-12 offset-md-2 col-md-8">
                    <form method="POST" action="{% url 'edit_menu_item' menu_item.id %}" class="menu-item-form hidden">
                        {% csrf_token %}
                        {{ menu_item_form | crispy }}
                        <!-- Assuming `menu_item_form` will be populated in the view -->
                        <button type="submit" class="btn btn-signup btn-submit btn-lg">Save Changes</button>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <p>No items available in this category.</p>
        {% endfor %}

        {% if user.is_authenticated and user.is_superuser %}
        <div>
            <a href="#" class="btn btn-success add-btn" data-category="{{ category_label }}">
                <i class="fas fa-plus"></i> Add New {{ category_label }}
            </a>
        </div>

        <!-- Form to add menu item, initially hidden by the 'hidden' class -->
        <div class="row category-form" data-category="{{ category_label }}">
            <div class="col-12 offset-md-2 col-md-8">
                <form method="POST" class="menu-item-form hidden">
                    {{ menu_item_form | crispy }}
                    {% csrf_token %}
                    <button type="submit" class="btn btn-signup btn-submit btn-lg">Submit</button>
                    <input type="hidden" name="category" value="{{ category_label | lower }}">
                </form>
            </div>
        </div>

        {% endif %}
    </div>
    {% endfor %}

</div>

{% endblock content %}

{% block extras %}
<script src="{% static 'js/menu.js' %}"></script>
{% endblock %}